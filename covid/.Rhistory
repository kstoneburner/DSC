#######################################################
loop_county_df[is.na(loop_county_df)] = 0
#print("------------------------")
#print(county_name)
#print("------------------------")
#print(tail(loop_county_df))
#print(county_name)
########################################################################################################
#### Build Weights based on percentage of total deathss
########################################################################################################
### Get County Population
#loop_pop_weight <- ca_population_df[which(ca_population_df$county==county_name),]$population
### There are at least two invalid counties - Out of County and Unassigned. Set Weight to 0
#if ( length(loop_pop_weight)  == 0)  {loop_pop_weight=0}
### Weight is a percentage of total population
#loop_pop_weight <- loop_pop_weight / ca_pop
#print("Pop weight")
#print(loop_pop_weight)
########################################################################################################
#### Build Weighted values - these values are multiplied by their percentage of the population
########################################################################################################
#############################################################################
### Replace NA with 0. The Models should not be generating NA
### But it's likely from low population counties. Let's go with it ATM.
#############################################################################
#loop_county_df$predict_offset[is.na(loop_county_df$predict_offset)] <- 0
#loop_county_df$predict_intercept[is.na(loop_county_df$predict_intercept)] <- 0
#loop_county_df$predict_coefficient[i/2s.na(loop_county_df$predict_coefficient)] <- 0
loop_death_weight <- loop_county_df$prediction/output_deaths
loop_death_weight[is.na(loop_death_weight)] = 0
#print(loop_death_weight)
total_weight <- total_weight +  loop_death_weight
output_intercept <- (output_intercept + (loop_county_df$predict_intercept * loop_death_weight) )
output_offset <-    (output_offset + (loop_county_df$predict_offset * loop_death_weight) )
temp_co <- (loop_county_df$predict_coefficient * loop_death_weight)
output_coefficient <- (output_coefficient +  temp_co)
total_predict <- ( total_predict + (loop_county_df$prediction * loop_death_weight) )
#print(loop_county_df$predict_coefficient)
#print(loop_county_df$predict_coefficient * loop_death_weight)
#print(loop_county_df$prediction * loop_death_weight)
#print(tail(
#  data.frame(
#    total=output_deaths,
#    county=loop_county_df$prediction,
#    percent=loop_county_df$prediction/output_deaths,
#    coef=loop_county_df$predict_coefficient,
#    percent_coef=loop_county_df$predict_coefficient*(loop_county_df$prediction/output_deaths)
#    )))
}#//*** END Each county filename
return(data.frame(
prediction          = output_deaths,
dependent           = output_dependent,
predict_offset      = output_offset,
predict_mse         = output_mse
#predict_intercept   = output_intercept,
#predict_coefficient = output_coefficient
))
}#//END build_statewide_model_from_counties
{ #//BEGIN Code Chunk #2: Build State Models and Death_frame
print("Processing: Code Chunk#2")
##############################
### Build Statewide Models ###
#############################################################################
### Aggregates expensive county models into statewide California numbers. ###
#############################################################################
### Confirmed cases predicting outcomes
confirm_predict_death_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_deaths"))
confirm_predict_hospital_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_hospital"))
confirm_predict_icu_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_icu"))
#### Hospitalization predict outcomes
hospital_predict_icu_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\hospital_~_icu"))
hospital_predict_deaths_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\hospital_~_deaths"))
#### ICU predict death
icu_predict_deaths_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\icu_~_deaths"))
### Correlate offset with MSE. I wonder what else correlates with MSE
cor(confirm_predict_death_model_df$predict_offset,confirm_predict_death_model_df$predict_mse)
### Confirm Predicting New Deaths is a shit model. Error only increases
#confirm_predict_newdeaths_model_df   <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_newdeaths"))
newconfirm_predict_newsdeaths_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\newconfirm_~_newdeaths"))
newconfirm_predict_hospital_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\newconfirm_~_hospital"))
newconfirm_predict_icu_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\newconfirm_~_icu"))
hospital_predict_newdeaths_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\hospital_~_newdeaths"))
icu_predict_newdeaths_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\icu_~_newdeaths"))
### Testing to deaths model is very noisy. Can only build from aggregate state numbers have State
### Build testing Model from aggreagte state numbers
testing_predict_deaths_df <- build_rolling_lm_offset(offset_testing_df,"daily_total_deaths",15)
#########################################################
### Trim up testing to same Data length as other models
#########################################################
### Yes, it's ugly but it runs with one command.
### Basically, it's start at the row difference to the nrows in data frame
###############################################################################
testing_predict_deaths_df <- testing_predict_deaths_df[
(nrow(testing_predict_deaths_df) - nrow(confirm_predict_death_model_df) + 1):
nrow(testing_predict_deaths_df),]
######################################################################
######################################################################
######################################################################
### END Modeling #####################################################
######################################################################
######################################################################
######################################################################
##############################################################
### Build the death model.
### Death model combines actual data points with the models
####################################################################
####################################################################
### Death Model: Initialize with Testing and Confirmed/Deaths
####################################################################
death_model_df <- merge(removeCols(ca_testing_df,"daily_total_deaths"),daily_covid_df)
###############################################
### Death Model: Add Actual Hospital Values
###############################################
death_model_df <- merge(death_model_df,daily_hospital_df)
#######################################
### Death Model: Add Testing ~ Deaths
#######################################
death_model_df$testing_death_mse         <- testing_predict_deaths_df$mse
death_model_df$testing_death_predict     <- testing_predict_deaths_df$predicted_deaths
death_model_df$testing_death_offset      <- testing_predict_deaths_df$offset_index
#  death_model_df$testing_death_intercept   <- testing_predict_deaths_df$lm_intercept
#  death_model_df$testing_death_coefficient <- testing_predict_deaths_df$lm_coefficient
#######################################
### Death Model: Add Confirmed ~ Deaths
#######################################
death_model_df$confirm_death_mse         <- confirm_predict_death_model_df$predict_mse
death_model_df$confirm_death_predict     <- confirm_predict_death_model_df$prediction
death_model_df$confirm_death_offset      <- confirm_predict_death_model_df$predict_offset
#  death_model_df$confirm_death_intercept   <- confirm_predict_death_model_df$predict_intercept
#  death_model_df$confirm_death_coefficient <- confirm_predict_death_model_df$predict_coefficient
#######################################
### Death Model: Add Confirm ~ Hospital
#######################################
death_model_df$confirm_hospital_mse         <- confirm_predict_hospital_model_df$predict_mse
death_model_df$confirm_hospital_predict     <- confirm_predict_hospital_model_df$prediction
death_model_df$confirm_hospital_offset      <- confirm_predict_hospital_model_df$predict_offset
#  death_model_df$confirm_hospital_intercept   <- confirm_predict_hospital_model_df$predict_intercept
#  death_model_df$confirm_hospital_coefficient <- confirm_predict_hospital_model_df$predict_coefficient
#######################################
### Death Model: Add confirm ~ icu
#######################################
death_model_df$confirm_icu_mse         <- confirm_predict_icu_model_df$predict_mse
death_model_df$confirm_icu_predict     <- confirm_predict_icu_model_df$prediction
death_model_df$confirm_icu_offset      <- confirm_predict_icu_model_df$predict_offset
#  death_model_df$confirm_icu_intercept   <- confirm_predict_icu_model_df$predict_intercept
#  death_model_df$confirm_icu_coefficient <- confirm_predict_icu_model_df$predict_coefficient
death_model_df$newconfirm_newdeath_mse        <- newconfirm_predict_newsdeaths_model_df$predict_mse
death_model_df$newconfirm_newdeath_prediction <- newconfirm_predict_newsdeaths_model_df$prediction
death_model_df$newconfirm_newdeath_offset     <- newconfirm_predict_newsdeaths_model_df$predict_offset
death_model_df$newconfirm_hospital_mse        <- newconfirm_predict_hospital_model_df$predict_mse
death_model_df$newconfirm_hospital_prediction <- newconfirm_predict_hospital_model_df $prediction
death_model_df$newconfirm_hospital_offset     <- newconfirm_predict_hospital_model_df$predict_offset
death_model_df$newconfirm_icu_mse        <- newconfirm_predict_icu_model_df$predict_mse
death_model_df$newconfirm_icu_prediction <- newconfirm_predict_icu_model_df$prediction
death_model_df$newconfirm_icu_offset     <- newconfirm_predict_icu_model_df$predict_offset
#######################################
### Death Model: Add hospital ~ icu
#######################################
death_model_df$hospital_icu_mse         <- hospital_predict_icu_model_df$predict_mse
death_model_df$hospital_icu_predict     <- hospital_predict_icu_model_df$prediction
death_model_df$hospital_icu_offset      <- hospital_predict_icu_model_df$predict_offset
#  death_model_df$hospital_icu_intercept   <- hospital_predict_icu_model_df$predict_intercept
#  death_model_df$hospital_icu_coefficient <- hospital_predict_icu_model_df$predict_coefficient
#######################################
### Death Model: Add hospital ~ death
#######################################
death_model_df$hospital_death_mse         <- hospital_predict_deaths_df$predict_mse
death_model_df$hospital_death_predict     <- hospital_predict_deaths_df$prediction
death_model_df$hospital_death_offset      <- hospital_predict_deaths_df$predict_offset
#  death_model_df$hospital_death_intercept   <- hospital_predict_deaths_df$predict_intercept
#  death_model_df$hospital_death_coefficient <- hospital_predict_deaths_df$predict_coefficient
death_model_df$hospital_newdeath_mse        <- hospital_predict_newdeaths_model_df$predict_mse
death_model_df$hospital_newdeath_prediction <- hospital_predict_newdeaths_model_df$prediction
death_model_df$hospital_newdeath_offset     <- hospital_predict_newdeaths_model_df$predict_offset
#######################################
### Death Model: Add icu ~ death
#######################################
death_model_df$icu_death_mse         <- icu_predict_deaths_df$predict_mse
death_model_df$icu_death_prediction  <- icu_predict_deaths_df$prediction
death_model_df$icu_death_offset      <- icu_predict_deaths_df$predict_offset
#  death_model_df$icu_death_intercept   <- icu_predict_deaths_df$predict_intercept
#  death_model_df$icu_death_coefficient <- icu_predict_deaths_df$predict_coefficient
death_model_df$icu_newdeaths_mse        <- icu_predict_newdeaths_model_df$predict_mse
death_model_df$icu_newdeaths_prediction <- icu_predict_newdeaths_model_df$prediction
death_model_df$icu_newdeaths_offset     <- icu_predict_newdeaths_model_df$predict_offset
print("DONE: Code Chunk#2")
}#//END Code Chunk #2: Build State Models and Death_frame
data.frame(
actual_hospital=death_model_df$hospitalized_covid_patients,
predict_hospital=newconfirm_predict_hospital_model_df$prediction)
tail(
data.frame(confirm=death_model_df$daily_total_confirmed,
coef=death_model_df$confirm_death_coefficient,
deaths=death_model_df$daily_total_deaths,
predict=death_model_df$confirm_death_predict,
tested=death_model_df$tested,
coef_c=death_model_df$testing_death_coefficient,
inter_c=death_model_df$testing_death_intercept,
predict_c=death_model_df$testing_death_predict,
offset_c=death_model_df$testing_death_offset
)
)
tail(
data.frame(confirm=death_model_df$daily_total_confirmed,
coef=death_model_df$confirm_death_coefficient,
deaths=death_model_df$daily_total_deaths,
predict=death_model_df$confirm_death_predict,
tested=death_model_df$tested,
offset_c=death_model_df$testing_death_offset
)
)
tail(
data.frame(confirm=death_model_df$daily_total_confirmed,
deaths=death_model_df$daily_total_deaths,
predict=death_model_df$confirm_death_predict,
tested=death_model_df$tested,
offset_c=death_model_df$testing_death_offset
)
)
tail(
data.frame(confirm=death_model_df$daily_total_confirmed,
deaths=death_model_df$daily_total_deaths,
p_death=death_model_df$confirm_death_predict,
o_death=death_model_df$confirm_death_offset,
tested=death_model_df$tested,
o_tested=death_model_df$testing_death_offset
)
)
sum(newconfirm_predict_hospital_model_df$predict_mse)
sum(icu_predict_newdeaths_model_df$predict_mse)
death_model_df$
confirm_predict_newdeaths_model_df
sum(death_model_df$icu_death_mse)
sum(death_model_df$icu_newdeaths_mse)
sum(death_model_df$icu_newdeaths_mse)
sum(death_model_df$icu_death_mse)
daily_covid_df
data.frame(
tot_deaths=death_model_df$daily_total_deaths,
new_deaths=death_model_df$new_confimed,
testing=death_model_df$testing_death_predict,
confirm=death_model_df$confirm_death_predict,
hospital=death_model_df$hospital_death_predict,
icu=death_model_df$icu_death_prediction
)
data.frame(
tot_deaths=death_model_df$daily_total_deaths,
#new_deaths=death_model_df$new_confimed,
testing=death_model_df$testing_death_predict,
confirm=death_model_df$confirm_death_predict,
hospital=death_model_df$hospital_death_predict,
icu=death_model_df$icu_death_prediction
)
data.frame(
#tot_deaths=death_model_df$daily_total_deaths,
#new_deaths=death_model_df$new_confimed,
testing=death_model_df$testing_death_mse,
confirm=death_model_df$confirm_death_mse,
hospital=death_model_df$hospital_death_mse,
icu=death_model_df$icu_death_mse
)
daily_covid_df
data.frame(
tot_deaths=death_model_df$daily_total_deaths,
new_deaths=death_model_df$new_deaths,
testing=death_model_df$testing_death_predict,
confirm=death_model_df$confirm_death_predict,
hospital=death_model_df$hospital_death_predict,
icu=death_model_df$icu_death_prediction
)
data.frame(
tot_deaths=death_model_df$daily_total_deaths,
#new_deaths=death_model_df$new_deaths,
testing=death_model_df$testing_death_predict,
confirm=death_model_df$confirm_death_predict,
hospital=death_model_df$hospital_death_predict,
icu=death_model_df$icu_death_prediction
)
data.frame(
new_deaths=death_model_df$new_deaths,
death_model_df$
)
data.frame(
new_deaths=death_model_df$new_deaths,
death_model_df$icu_newdeaths_prediction
)
data.frame(
new_deaths=death_model_df$new_deaths,
icu=death_model_df$icu_newdeaths_prediction
)
### ICU count does not correlate well with eith deaths or new deaths
data.frame(
new_deaths=death_model_df$new_deaths,
icu_new=death_model_df$icu_newdeaths_prediction,
tot_deaths=death_model_df$daily_total_deaths,
icu=death_model_df$icu_death_prediction
)
### ICU count does not correlate well with eith deaths or new deaths
data.frame(
new_deaths=death_model_df$new_deaths,
icu_new=death_model_df$icu_newdeaths_prediction,
icu_new_mse=death_model_df$icu_newdeaths_mse,
icu_new_mse=death_model_df$icu_newdeaths_offset,
tot_deaths=death_model_df$daily_total_deaths,
icu=death_model_df$icu_death_prediction
)
#### put ICU to bed
### ICU count does not correlate well with deaths or new deaths
### It is very difficult to predict who will die from ICU numbers
### The MSE's are way off
data.frame(
new_deaths=death_model_df$new_deaths,
icu_new=death_model_df$icu_newdeaths_prediction,
icu_new_mse=death_model_df$icu_newdeaths_mse,
tot_deaths=death_model_df$daily_total_deaths,
icu=death_model_df$icu_death_prediction,
icu_tot_mse=death_model_df$icu_death_mse
)
data.frame(
#tot_deaths=death_model_df$daily_total_deaths,
#new_deaths=death_model_df$new_confimed,
testing=death_model_df$testing_death_mse,
confirm=death_model_df$confirm_death_mse,
hospital=death_model_df$hospital_death_mse,
icu=death_model_df$icu_death_mse
)
sum(death_model_df$testing_death_mse)
sum(death_model_df$confirm_death_mse)
sum(death_model_df$hospital_death_mse)
sum(death_model_df$icu_death_mse)
offset_testing_df
confirm_predict_newdeath_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_newdeaths"))
{ #//BEGIN Code Chunk #2: Build State Models and Death_frame
print("Processing: Code Chunk#2")
##############################
### Build Statewide Models ###
#############################################################################
### Aggregates expensive county models into statewide California numbers. ###
#############################################################################
### Confirmed cases predicting outcomes
confirm_predict_death_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_deaths"))
confirm_predict_newdeath_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_newdeaths"))
confirm_predict_hospital_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_hospital"))
confirm_predict_icu_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_icu"))
#### Hospitalization predict outcomes
hospital_predict_icu_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\hospital_~_icu"))
hospital_predict_deaths_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\hospital_~_deaths"))
#### ICU predict death
icu_predict_deaths_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\icu_~_deaths"))
### Correlate offset with MSE. I wonder what else correlates with MSE
cor(confirm_predict_death_model_df$predict_offset,confirm_predict_death_model_df$predict_mse)
### Confirm Predicting New Deaths is a shit model. Error only increases
#confirm_predict_newdeaths_model_df   <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\confirm_~_newdeaths"))
newconfirm_predict_newsdeaths_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\newconfirm_~_newdeaths"))
newconfirm_predict_hospital_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\newconfirm_~_hospital"))
newconfirm_predict_icu_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\newconfirm_~_icu"))
hospital_predict_newdeaths_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\hospital_~_newdeaths"))
icu_predict_newdeaths_model_df <- build_statewide_model_from_counties(paste0(workingDir,"\\models\\icu_~_newdeaths"))
### Testing to deaths model is very noisy. Can only build from aggregate state numbers have State
### Build testing Model from aggreagte state numbers
testing_predict_deaths_df <- build_rolling_lm_offset(offset_testing_df,"daily_total_deaths",15)
offset_testing_df
#########################################################
### Trim up testing to same Data length as other models
#########################################################
### Yes, it's ugly but it runs with one command.
### Basically, it's start at the row difference to the nrows in data frame
###############################################################################
testing_predict_deaths_df <- testing_predict_deaths_df[
(nrow(testing_predict_deaths_df) - nrow(confirm_predict_death_model_df) + 1):
nrow(testing_predict_deaths_df),]
######################################################################
######################################################################
######################################################################
### END Modeling #####################################################
######################################################################
######################################################################
######################################################################
##############################################################
### Build the death model.
### Death model combines actual data points with the models
####################################################################
####################################################################
### Death Model: Initialize with Testing and Confirmed/Deaths
####################################################################
death_model_df <- merge(removeCols(ca_testing_df,"daily_total_deaths"),daily_covid_df)
###############################################
### Death Model: Add Actual Hospital Values
###############################################
death_model_df <- merge(death_model_df,daily_hospital_df)
#######################################
### Death Model: Add Testing ~ Deaths
#######################################
death_model_df$testing_death_mse         <- testing_predict_deaths_df$mse
death_model_df$testing_death_predict     <- testing_predict_deaths_df$predicted_deaths
death_model_df$testing_death_offset      <- testing_predict_deaths_df$offset_index
#  death_model_df$testing_death_intercept   <- testing_predict_deaths_df$lm_intercept
#  death_model_df$testing_death_coefficient <- testing_predict_deaths_df$lm_coefficient
#######################################
### Death Model: Add Confirmed ~ Deaths
#######################################
death_model_df$confirm_death_mse         <- confirm_predict_death_model_df$predict_mse
death_model_df$confirm_death_predict     <- confirm_predict_death_model_df$prediction
death_model_df$confirm_death_offset      <- confirm_predict_death_model_df$predict_offset
#  death_model_df$confirm_death_intercept   <- confirm_predict_death_model_df$predict_intercept
#  death_model_df$confirm_death_coefficient <- confirm_predict_death_model_df$predict_coefficient
death_model_df$confirm_newdeath_mse      <- confirm_predict_newdeath_model_df$predict_mse
death_model_df$confirm_newdeath_predict  <- confirm_predict_newdeath_model_df$prediction
death_model_df$confirm_newdeath_offset   <- confirm_predict_newdeath_model_df$predict_offset
#######################################
### Death Model: Add Confirm ~ Hospital
#######################################
death_model_df$confirm_hospital_mse         <- confirm_predict_hospital_model_df$predict_mse
death_model_df$confirm_hospital_predict     <- confirm_predict_hospital_model_df$prediction
death_model_df$confirm_hospital_offset      <- confirm_predict_hospital_model_df$predict_offset
#  death_model_df$confirm_hospital_intercept   <- confirm_predict_hospital_model_df$predict_intercept
#  death_model_df$confirm_hospital_coefficient <- confirm_predict_hospital_model_df$predict_coefficient
#######################################
### Death Model: Add confirm ~ icu
#######################################
death_model_df$confirm_icu_mse         <- confirm_predict_icu_model_df$predict_mse
death_model_df$confirm_icu_predict     <- confirm_predict_icu_model_df$prediction
death_model_df$confirm_icu_offset      <- confirm_predict_icu_model_df$predict_offset
#  death_model_df$confirm_icu_intercept   <- confirm_predict_icu_model_df$predict_intercept
#  death_model_df$confirm_icu_coefficient <- confirm_predict_icu_model_df$predict_coefficient
death_model_df$newconfirm_newdeath_mse        <- newconfirm_predict_newsdeaths_model_df$predict_mse
death_model_df$newconfirm_newdeath_prediction <- newconfirm_predict_newsdeaths_model_df$prediction
death_model_df$newconfirm_newdeath_offset     <- newconfirm_predict_newsdeaths_model_df$predict_offset
death_model_df$newconfirm_hospital_mse        <- newconfirm_predict_hospital_model_df$predict_mse
death_model_df$newconfirm_hospital_prediction <- newconfirm_predict_hospital_model_df $prediction
death_model_df$newconfirm_hospital_offset     <- newconfirm_predict_hospital_model_df$predict_offset
death_model_df$newconfirm_icu_mse        <- newconfirm_predict_icu_model_df$predict_mse
death_model_df$newconfirm_icu_prediction <- newconfirm_predict_icu_model_df$prediction
death_model_df$newconfirm_icu_offset     <- newconfirm_predict_icu_model_df$predict_offset
#######################################
### Death Model: Add hospital ~ icu
#######################################
death_model_df$hospital_icu_mse         <- hospital_predict_icu_model_df$predict_mse
death_model_df$hospital_icu_predict     <- hospital_predict_icu_model_df$prediction
death_model_df$hospital_icu_offset      <- hospital_predict_icu_model_df$predict_offset
#  death_model_df$hospital_icu_intercept   <- hospital_predict_icu_model_df$predict_intercept
#  death_model_df$hospital_icu_coefficient <- hospital_predict_icu_model_df$predict_coefficient
#######################################
### Death Model: Add hospital ~ death
#######################################
death_model_df$hospital_death_mse         <- hospital_predict_deaths_df$predict_mse
death_model_df$hospital_death_predict     <- hospital_predict_deaths_df$prediction
death_model_df$hospital_death_offset      <- hospital_predict_deaths_df$predict_offset
#  death_model_df$hospital_death_intercept   <- hospital_predict_deaths_df$predict_intercept
#  death_model_df$hospital_death_coefficient <- hospital_predict_deaths_df$predict_coefficient
death_model_df$hospital_newdeath_mse        <- hospital_predict_newdeaths_model_df$predict_mse
death_model_df$hospital_newdeath_prediction <- hospital_predict_newdeaths_model_df$prediction
death_model_df$hospital_newdeath_offset     <- hospital_predict_newdeaths_model_df$predict_offset
#######################################
### Death Model: Add icu ~ death
#######################################
death_model_df$icu_death_mse         <- icu_predict_deaths_df$predict_mse
death_model_df$icu_death_prediction  <- icu_predict_deaths_df$prediction
death_model_df$icu_death_offset      <- icu_predict_deaths_df$predict_offset
#  death_model_df$icu_death_intercept   <- icu_predict_deaths_df$predict_intercept
#  death_model_df$icu_death_coefficient <- icu_predict_deaths_df$predict_coefficient
death_model_df$icu_newdeaths_mse        <- icu_predict_newdeaths_model_df$predict_mse
death_model_df$icu_newdeaths_prediction <- icu_predict_newdeaths_model_df$prediction
death_model_df$icu_newdeaths_offset     <- icu_predict_newdeaths_model_df$predict_offset
print("DONE: Code Chunk#2")
}#//END Code Chunk #2: Build State Models and Death_frame
#### New Deaths
sum(death_model_df$confirm_newdeath_mse)
sum(death_model_df$newconfirm_newdeath_mse)
sum(death_model_df$confirm_death_mse)
sum(death_model_df$newconfirm_hospital_mse)
sum(death_model_df$newconfirm_icu_mse )
sum(death_model_df$confirm_newdeath_mse)
sum(death_model_df$newconfirm_newdeath_mse)
sum(death_model_df$confirm_death_mse)
sum(death_model_df$confirm_hospital_mse)
sum(death_model_df$confirm_icu_mse)
sum(death_model_df$confirm_death_mse)
sum(death_model_df$hospital_icu_mse )
sum(death_model_df$hospital_death_mse )
sum(death_model_df$hospital_newdeath_mse )
sum(death_model_df$icu_newdeaths_mse )
offset_testing_df
offset_daily_df
ca_combined_df
daily_hospital_df
daily_hospital_df
daily_covid_df
daily_combined_df <- merge(daily_covid_df,daily_hospital_df)
daily_combined_df
offset_daily_df <- build_offset_columns(daily_combined_df,"daily_total_confirmed",2:30)
tail(offset_daily_df)
#offset_lm_15_df <- build_rolling_lm_offset(offset_daily_df,"daily_total_deaths",15)
confirm_predict_death_model_lm_df  <- build_rolling_lm_offset(offset_daily_df,"daily_total_deaths",15)
confirm_predict_death_model_lm_df
### Build state level models to see if less granularity helps
offset_daily_df
confirm_predict_hospital_model_lm_df <- build_rolling_lm_offset(offset_daily_df,"hospitalized_covid_patients",15)
confirm_predict_hospital_model_lm_df$mse
sum(confirm_predict_hospital_model_lm_df$mse)
confirm_predict_hospital_model_lm_df$predicted_deaths
data.frame(
confirm_predict_hospital_model_lm_df$predicted_deaths,
daily_combined_df$hospitalized_covid_patients
)
data.frame(
actual=daily_combined_df$hospitalized_covid_patients,
predict=confirm_predict_hospital_model_lm_df$predicted_deaths
)
sum(daily_combined_df$hospitalized_covid_patients) / sum(confirm_predict_hospital_model_lm_df$predicted_deaths)
sum(confirm_predict_hospital_model_lm_df$predicted_deaths) / sum(daily_combined_df$hospitalized_covid_patients)
1- sum(confirm_predict_hospital_model_lm_df$predicted_deaths) / sum(daily_combined_df$hospitalized_covid_patients)
