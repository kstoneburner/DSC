<html>
<style>
.BSZ{
	background : #CFDFFF;
}

.PMP {
	background : #D0F0FD;
}

.GLL{
	background :#C2F5E9;
}

.OOO{
	background :#D1F7C4;
}

.LSH{
	background :#FEE2D5;
}

.MGT{
	background :#FFDCE5;
}

.SAW{
	background :#FFDAF6;
}

.MIC{
	background :#EDE2FE;
}

.WTW{
	background :#EEEEEE;
}

.CYC{
	background :#9CC7FF;
}

.PTL{
	background :#77D1F3;
}

.HOU{
	background :#F82B60;
}
.LOS{
	background :#FDD081;
}
.PET{
	background :#77D1F3;
}
.HOL{
	background :#F99DE2;
}
.ALL{
	background :#CDB0FF;
}
.MUS{
	background :#2D7FF9;
}
.BAY{
	background :#18BFFF;
}
.CHI{
	background :#20D9D2;
}
.PHI{
	background :#20C933;
}
.NYC{
	background :#FF6F2C;
}
.SOG{
	background :#D0F0FD;
}
.LIFE{
	background :#2750AE;
}
.VLY{
	background :#2750AE;
}
.special{
	background :#BA1E45;
}
.BABY{
	background :#72DDC3;
}
</style>

<script>
var m = { 
	fieldKeys : [],
	series : {},
	fields : {}
}

function readText(){

	cl("Let's get JSON LOADED ")
	var input = document.createElement('input');
	input.type = 'file';
	

	input.onchange = e => { 
	   // getting a hold of the file reference
	   var file = e.target.files[0]; 

	   // setting up the reader
	   var reader = new FileReader();
	   reader.readAsText(file,'UTF-8');

	   // here we tell the reader what to do when it's done reading...
	   reader.onload = readerEvent => {
	      var importOBJ = readerEvent.target.result; // this is the content!
	      
	      try
	      {
	      	importOBJ = JSON.parse(importOBJ);
  	
	      }//*** END import Parse Try
	      catch(e)
	      {
	      	alert("Unable to parse file: " + file.name + "\nPlease select a valid Hotkey JSON File");
	      	return;
	      }//**** END Main Import 
	      
		  //cl(importOBJ)
		 	for (topIndex in importOBJ.records) {
			
			   	var rawFields = importOBJ.records[topIndex].fields
					
					//**** Build key names from fields
					if (m.fieldKeys.length == 0){
						for (x in rawFields){
							m.fieldKeys.push(x);
						}
						
						//cl(m.fieldKeys);
					}
				
				var thisOBJ = {};
				//**** Get the housenumber located at first index of field Keys
				var thisHousenumber = rawFields[m.fieldKeys[0]];
				
				//**** Build each episode object
				for ( x in m.fieldKeys){
					
					var thisKey = m.fieldKeys[x];
					
					//cl(thisHousenumber + ":" + thisKey + ":" + rawFields[thisKey]);
					
					var thisValue = rawFields[thisKey];
					
					if (typeof(thisValue) == 'undefined'){ thisValue = "_" };
					
					thisOBJ[thisKey] = thisValue;
				}
				
				//*** Add episode to m.fields
				m.fields[thisHousenumber] = thisOBJ;
				
				//**** Build Show Titles
				m.series[thisOBJ["Series"]] = thisOBJ["Series"];
			
			}//*** END each record
				
			//*** Get all episodes for each series
			for (scount in m.series){
				var thisSeries = m.series[scount];
				
				var thisEpisodeList = [];
				
				for (x in m.fields){
					
					if (thisSeries == m.fields[x].Series) {
						thisEpisodeList.push(x)
					}
				
				}//*** For each masterObject
				
				//**** Assign sorted episodes to the series				
				m.series[scount] = thisEpisodeList.sort();
				
			}//*** END each Series
			
				buildPage();
			
		}//*** Handle Input OnChange
	
	}//** END input.onchange
	//*** Is this Close or open? Not Sure
	input.click();
			
}//*** END readText

function cl(input){
	console.log(input)
}

function getElem(elem){
	return(document.getElementById(elem))
}

function tdChange(e){
	
	//***Series Changed, draw new Episode List
	var newSeriesKey = e.target.value
		
	//*** Delete existing episodes
	while (e.target.nextSibling.childNodes.length > 0) {
		e.target.nextSibling.removeChild(e.target.nextSibling.childNodes[0])
	}

	e.target.className = newSeriesKey;
	
	//*** Add New Episodes
	var thisSeries = m.series[newSeriesKey]
		
	for (x in thisSeries){
		var opt1 = document.createElement('option');
		opt1.text = thisSeries[x];
		opt1.value = thisSeries[x];
		e.target.nextSibling.add(opt1);
	}
	e.target.nextSibling.className = newSeriesKey;
}//*** END tdChange



function buildShowTD(){
	//******************************
	//**** Build One TD Element
	//******************************

	var td = document.createElement("td");

	//**** Build Series Drop Down
	var series = document.createElement("select");

	series.id="series";
	firstKey = ""
	
	for (x in m.series){
		var opt1 = document.createElement('option');
		if (firstKey == "") {
			firstKey = x;
		}
		opt1.text = x;
		opt1.value = x;
		opt1.className = x;
		series.add(opt1);
		td.appendChild(series);
	}//*** END each Series

	series.className = firstKey;
	

	var episodes = document.createElement("select");
	episodes.id="episodes";
	episodes.className = firstKey;
	
	
	var thisSeries = m.series[firstKey]
		
	for (x in thisSeries){
		var opt1 = document.createElement('option');
		opt1.text = thisSeries[x];
		opt1.value = thisSeries[x];
		episodes.add(opt1);
		td.appendChild(episodes);
	}
	
	series.addEventListener("change",function(e){tdChange(e)});
	
	
	
	return td;
	
}//*** END Build ShowTD

function autobuild_mf_row(inputOBJ){
	var parent = inputOBJ.srcElement.parentNode;
	cl(parent);
	var firstTD = parent.children[1];

	cl("Series: " + firstTD.children[0].value);
	cl("Episode: " + firstTD.children[1].value);

	var startSeries = firstTD.children[0].value;
	var startEpisode = firstTD.children[1].value;

	//*** Build Row based on start series
	var thisRowList = [];

	var showOBJ = {
		series : startSeries,
		episode : startEpisode
	}

	//*** get start episode index
	var theseEpisodes = m.series[startSeries];

	var episodeIndex = -1;

	for (x=0;x<theseEpisodes.length;x++){

		if ( theseEpisodes[x] == startEpisode){

			episodeIndex = x;

		}//*** END get find index

	}//*** END find Episode Index

	thisRowList.push(showOBJ)

	for (x=1;x<7;x++){

		//*** Increment episode Index, Starting from found Value
		episodeIndex++;

		//*** Reset Index to 0 if out of bounds
		if (episodeIndex > theseEpisodes.length -1 ){ episodeIndex = 0 }

		//*** Build Suggestions and add to list
		thisRowList.push({
			series : startSeries,
			episode : theseEpisodes[episodeIndex]
		});

	}//*** END build suggested shows

	cl("ThisRow List: " + thisRowList)
	
	//*** Find Index of current Row
	var mainTable = parent.parentNode;

	
	//*** Loop through mainTable to find the parent Row. We need this Index to update the Row Values.
	//for (x=0;x<mainTable.children.length - 1;x++){

		//if (parent == mainTable.children[x]) {
			//*** Parent Found, x is RowIndex.
			//*** Let's Update!!!

			update_mainTable_row(parent.id,thisRowList)
			//break;		
		//}

	//}//*** END maintable Row Loop



}//*** END autobuild_mf_row

function autobuild_tu_thu_row(inputOBJ){
	var parent = inputOBJ.srcElement.parentNode;
	cl(parent);
	var firstTD = parent.children[1];

	cl("Series: " + firstTD.children[0].value);
	cl("Episode: " + firstTD.children[1].value);

	var startSeries = firstTD.children[0].value;
	var startEpisode = firstTD.children[1].value;

	//*** Build Row based on start series
	var thisRowList = [];

	var thuSeries = ""
	var thuEpisode = ""

	//*** Get all selections in row
	//*** Build the value for the row. Increment Thursday based on Tuesday
	for (x=1;x<8;x++){


		var showOBJ = {
			series : parent.children[x].children[0].value,
			episode : parent.children[x].children[1].value
		}

		switch(x){

			case 2:
				//*** Tuesday's show. Build Thursday's show
				//*** Assign series, that was easy
				thuSeries = showOBJ.series

				cl(showOBJ.series + ":" + showOBJ.episode)

				//***Increment Episode, this is lil more work ;)
				var theseEpisodes = m.series[showOBJ.series];

				var episodeIndex = -1;

				for (xx=0;xx<theseEpisodes.length;xx++){

					if ( theseEpisodes[xx] == showOBJ.episode){

						episodeIndex = xx;

					}//*** END get find index

				}//*** END find Episode Index

				//*** Increment found Index
				episodeIndex++;

				if (episodeIndex == theseEpisodes.length){

					episodeIndex = 0;

				}//*** END Reset episodeIndex to Beginning

				thuEpisode = theseEpisodes[episodeIndex];

				//cl("Increment: " + showOBJ.series + ":" + showOBJ.episode + ":" + episodeIndex)
				break
			case 4:
				showOBJ = {
					series : thuSeries,
					episode : thuEpisode
				}
				break

		}//*** END Switch Handle Tuesday Thursday

		cl(showOBJ)

		thisRowList.push(showOBJ)
	

	}//*** Each TD

	//*** Find Index of current Row
	var mainTable = parent.parentNode;

	
	//*** Loop through mainTable to find the parent Row. We need this Index to update the Row Values.
	//for (x=0;x<mainTable.children.length - 1;x++){

	//	if (parent == mainTable.children[x]) {
			//*** Parent Found, x is RowIndex.
			//*** Let's Update!!!
			update_mainTable_row(parent.id,thisRowList)
		//	break;		
	//	}

	//}//*** END maintable Row Loop

	return


	//*** get start episode index
	var theseEpisodes = m.series[startSeries];

	var episodeIndex = -1;

	for (x=0;x<theseEpisodes.length;x++){

		if ( theseEpisodes[x] == startEpisode){

			episodeIndex = x;

		}//*** END get find index

	}//*** END find Episode Index

	thisRowList.push(showOBJ)

	for (x=1;x<7;x++){

		//*** Increment episode Index, Starting from found Value
		episodeIndex++;

		//*** Reset Index to 0 if out of bounds
		if (episodeIndex > theseEpisodes.length -1 ){ episodeIndex = 0 }

		//*** Build Suggestions and add to list
		thisRowList.push({
			series : startSeries,
			episode : theseEpisodes[episodeIndex]
		});

	}//*** END build suggested shows

	cl("ThisRow List: " + thisRowList)
	
	//*** Find Index of current Row
	var mainTable = parent.parentNode;

	
	//*** Loop through mainTable to find the parent Row. We need this Index to update the Row Values.
	for (x=0;x<mainTable.children.length - 1;x++){

		if (parent == mainTable.children[x]) {
			//*** Parent Found, x is RowIndex.
			//*** Let's Update!!!
			//update_mainTable_row(x,thisRowList)
			break;		
		}

	}//*** END maintable Row Loop



}//*** END autobuild_tu_thu_row

function buildAutoPopulate(inputOBJ){

	thisAction = inputOBJ.action;

	thisColumn = "";

	switch (thisAction){ 

		case "autobuild_mf":
	
			thisColumn = 1


			var button = document.createElement("button");
			button.innerHTML = "Autobuild - M-F"

			button.addEventListener("click",function(e){autobuild_mf_row(e)});

			return button;

		break;

		case "autobuild_tu_thu":
			thisColumn = 1

			var button = document.createElement("button");
			button.innerHTML = "Autobuild - Tu-Thu"

			button.addEventListener("click",function(e){autobuild_tu_thu_row(e)});

			return button;

	}//*** END switch Action


}//*** END Build autopoplate TD

function buildShowTR(input_time){

	newTR = document.createElement("tr");
	newTR.className = "mainRow"
	newTR.id = input_time
	
	newTD = document.createElement("td");
	newTD.className = "rowheader";
	newTD.innerHTML = input_time;
	
	newTR.appendChild(newTD);
	
	newTR.appendChild(buildShowTD())
	newTR.appendChild(buildShowTD())
	newTR.appendChild(buildShowTD())
	newTR.appendChild(buildShowTD())
	newTR.appendChild(buildShowTD())
	newTR.appendChild(buildShowTD())
	newTR.appendChild(buildShowTD())
	newTR.appendChild(buildAutoPopulate({action : "autobuild_mf", column : 1}))
	newTR.appendChild(buildAutoPopulate({action : "autobuild_tu_thu", column : 1}))
	
	//buildAutoPopulate({action : "autobuild", column : 1})
	
	return newTR
}

function copyRows(inputOBJ){

	//*** Build Row based on start series
	var thisRowList = [];


	//*** Copies select rows to other rows.
	sourceRow = getElem(inputOBJ["source"]);

	targets = inputOBJ["targets"];

	//*** Loop through Source Row and build RowList of Values
	for (sourceCounter in sourceRow.children) {


		if (sourceCounter > 0  && sourceCounter < 8) {
			var sourceSeries = sourceRow.children[sourceCounter].children[0].value;
			var sourceEpisode = sourceRow.children[sourceCounter].children[1].value;

			cl(sourceSeries + ":" + sourceEpisode);
			var showOBJ = {
				series : sourceSeries,
				episode : sourceEpisode
			}
			thisRowList.push(showOBJ);
	
		}//*** End Build each Show

	}//*** End Build rowList

	//*** Update the Targets with the row values
	//*** Need to find the children index value of the parent node.
	parent = sourceRow.parentNode;

	for (targetCounter in targets){

				update_mainTable_row(targets[targetCounter],thisRowList);

	}//*** END each target elem loop




}//*** END theBigRowCopy


function buildPage(){

	//*** Show/Hide Main Buttons
	getElem('import_layout').style.display = 'inline'
	getElem('export_layout').style.display = 'inline'
	getElem('readText').style.display = 'none'



	//************************************
	//*** Create Scheduling Main Table
	//************************************
	var mainTable = document.createElement("table");
	mainTable.id = "mainTable";

	var thisTR = document.createElement("tr");

	var headSpacer = document.createElement("th");

	var headMonday = document.createElement("th");
	var headTuesday = document.createElement("th");
	var headWednesday = document.createElement("th");
	var headThursday = document.createElement("th");
	var headFriday = document.createElement("th");
	var headSaturday = document.createElement("th");
	var headSunday = document.createElement("th");

	//************************************
	//*** Create Table header
	//************************************
	headSpacer.innerHTML = " ";
	headMonday.innerHTML = "Monday";
	headTuesday.innerHTML = "Tuesday";
	headWednesday.innerHTML = "Wednesday";
	headThursday.innerHTML = "Thursday";
	headFriday.innerHTML = "Friday";
	headSaturday.innerHTML = "Saturday";
	headSunday.innerHTML = "Sunday";

	thisTR.appendChild(headSpacer);
	thisTR.appendChild(headMonday);
	thisTR.appendChild(headTuesday);
	thisTR.appendChild(headWednesday);
	thisTR.appendChild(headThursday);
	thisTR.appendChild(headFriday);
	thisTR.appendChild(headSaturday);
	thisTR.appendChild(headSunday);

	mainTable.appendChild(headSpacer);
	mainTable.appendChild(headMonday);
	mainTable.appendChild(headTuesday);
	mainTable.appendChild(headWednesday);
	mainTable.appendChild(headThursday);
	mainTable.appendChild(headFriday);
	mainTable.appendChild(headSaturday);
	mainTable.appendChild(headSunday);


	//************************************
	//*** Build Table Row
	//************************************
	mainTable.appendChild(buildShowTR("4:00a"));
	mainTable.appendChild(buildShowTR("4:30a"));
	mainTable.appendChild(buildShowTR("5:00a"));
	mainTable.appendChild(buildShowTR("5:30a"));
	mainTable.appendChild(buildShowTR("6:00a"));
	mainTable.appendChild(buildShowTR("6:30a"));
	mainTable.appendChild(buildShowTR("7:00a"));
	mainTable.appendChild(buildShowTR("7:30a"));
	mainTable.appendChild(buildShowTR("8:00a"));
	mainTable.appendChild(buildShowTR("8:30a"));
	mainTable.appendChild(buildShowTR("9:00a"));
	mainTable.appendChild(buildShowTR("9:30a"));
	mainTable.appendChild(buildShowTR("10:00a"));
	mainTable.appendChild(buildShowTR("10:30a"));
	mainTable.appendChild(buildShowTR("11:00a"));
	mainTable.appendChild(buildShowTR("11:30a"));
	mainTable.appendChild(buildShowTR("12:00p"));
	mainTable.appendChild(buildShowTR("12:30p"));
	mainTable.appendChild(buildShowTR("1:00p"));
	mainTable.appendChild(buildShowTR("1:30p"));
	mainTable.appendChild(buildShowTR("2:00p"));
	mainTable.appendChild(buildShowTR("2:30p"));
	mainTable.appendChild(buildShowTR("3:00p"));
	mainTable.appendChild(buildShowTR("3:30p"));
	mainTable.appendChild(buildShowTR("4:00p"));
	mainTable.appendChild(buildShowTR("4:30p"));
	mainTable.appendChild(buildShowTR("5:00p"));
	mainTable.appendChild(buildShowTR("5:30p"));
	mainTable.appendChild(buildShowTR("6:00p"));
	mainTable.appendChild(buildShowTR("6:30p"));
	mainTable.appendChild(buildShowTR("7:00p"));
	mainTable.appendChild(buildShowTR("7:30p"));
	mainTable.appendChild(buildShowTR("8:00p"));
	mainTable.appendChild(buildShowTR("8:30p"));
	mainTable.appendChild(buildShowTR("9:00p"));
	mainTable.appendChild(buildShowTR("9:30p"));
	mainTable.appendChild(buildShowTR("10:00p"));
	mainTable.appendChild(buildShowTR("10:30p"));
	mainTable.appendChild(buildShowTR("11:00p"));
	mainTable.appendChild(buildShowTR("11:30p"));
	mainTable.appendChild(buildShowTR("12:00a"));
	mainTable.appendChild(buildShowTR("12:30a"));
	mainTable.appendChild(buildShowTR("1:00a"));
	mainTable.appendChild(buildShowTR("1:30a"));
	mainTable.appendChild(buildShowTR("2:00a"));
	mainTable.appendChild(buildShowTR("2:30a"));
	mainTable.appendChild(buildShowTR("3:00a"));
	mainTable.appendChild(buildShowTR("3:30a"));

	document.body.appendChild(mainTable);

	var copyPopulateButton11am = document.createElement("button");
	copyPopulateButton11am.innerHTML = "Populate: 11am"
	copyPopulateButton11am.addEventListener('click',function(event){ 
		copyRows({"source":"11:00a","targets":["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"]})
	});
	copyPopulateButton11am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["11:00a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   })

		styleRows({targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"], 
			       attribute : "background",
			       value : "green"
			   })

		styleRows({targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"], 
			       attribute : "outline",
			       value : "2px solid green"
			   })

			    //targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"],

	})
	copyPopulateButton11am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["11:00a"], 
			       attribute : "outline",
			       value : ""
			   })
		styleRows({targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"], 
			       attribute : "background",
			       value : ""
			   })

		styleRows({targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"], 
			       attribute : "outline",
			       value : ""
			   })

	})
	

	var copyPopulateButton1130am = document.createElement("button");
	copyPopulateButton1130am.innerHTML = "Populate: 11:30am"
	copyPopulateButton1130am.addEventListener('click',function(event){ 
		copyRows({"source":"11:30a","targets":["6:30a","9:30a","12:30p", "2:30p", "7:30p", "3:30a"]})
	});
	copyPopulateButton1130am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["11:30a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   })

		styleRows({targetIDs : ["6:30a","9:30a","12:30p", "2:30p", "7:30p", "3:30a"], 
			       attribute : "background",
			       value : "green"
			   })

		styleRows({targetIDs : ["6:30a","9:30a","12:30p", "2:30p", "7:30p", "3:30a"], 
			       attribute : "outline",
			       value : "2px solid green"
			   })

			    //targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"],

	})
	copyPopulateButton1130am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["11:30a"], 
			       attribute : "outline",
			       value : ""
			   })
		styleRows({targetIDs : ["6:30a","9:30a","12:30p", "2:30p", "7:30p", "3:30a"], 
			       attribute : "background",
			       value : ""
			   })

		styleRows({targetIDs : ["6:30a","9:30a","12:30p", "2:30p", "7:30p", "3:30a"], 
			       attribute : "outline",
			       value : ""
			   })

	})

	//12am -> 7am, 10am 1pm, 3pm 6pm, 8pm, 10p
	var copyPopulateButton12am = document.createElement("button");
	copyPopulateButton12am.innerHTML = "Populate: 12am"
	copyPopulateButton12am.addEventListener('click',function(event){ 
		copyRows({"source":"12:00a","targets":["7:00a","10:00a","1:00p", "3:00p", "6:00p", "8:00p","10:00p"]})
	});
	copyPopulateButton12am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["12:00a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   })

		styleRows({targetIDs : ["7:00a","10:00a","1:00p", "3:00p", "6:00p", "8:00p","10:00p"], 
			       attribute : "background",
			       value : "green"
			   })

		styleRows({targetIDs : ["7:00a","10:00a","1:00p", "3:00p", "6:00p", "8:00p","10:00p"], 
			       attribute : "outline",
			       value : "2px solid green"
			   })


	})
	copyPopulateButton12am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["12:00a"], 
			       attribute : "outline",
			       value : ""
			   })
		styleRows({targetIDs : ["7:00a","10:00a","1:00p", "3:00p", "6:00p", "8:00p","10:00p"], 
			       attribute : "background",
			       value : ""
			   })

		styleRows({targetIDs : ["7:00a","10:00a","1:00p", "3:00p", "6:00p", "8:00p","10:00p"], 
			       attribute : "outline",
			       value : ""
			   })

	})

	var copyPopulateButton1230am = document.createElement("button");
	copyPopulateButton1230am.innerHTML = "Populate: 12:30am"
	copyPopulateButton1230am.addEventListener('click',function(event){ 
		copyRows({"source":"12:30a","targets":["7:30a","10:30a","1:30p", "3:30p", "6:30p", "10:30p"]})
	});
	copyPopulateButton1230am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["12:30a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   })

		styleRows({targetIDs : ["7:30a","10:30a","1:30p", "3:30p", "6:30p", "10:30p"], 
			       attribute : "background",
			       value : "green"
			   })

		styleRows({targetIDs : ["7:30a","10:30a","1:30p", "3:30p", "6:30p", "10:30p"], 
			       attribute : "outline",
			       value : "2px solid green"
			   })

			    //targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"],

	})
	copyPopulateButton1230am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["12:30a"], 
			       attribute : "outline",
			       value : ""
			   })
		styleRows({targetIDs : ["7:30a","10:30a","1:30p", "3:30p", "6:30p", "10:30p"], 
			       attribute : "background",
			       value : ""
			   })

		styleRows({targetIDs : ["7:30a","10:30a","1:30p", "3:30p", "6:30p", "10:30p"], 
			       attribute : "outline",
			       value : ""
			   })

	})
	
	var copyPopulateButton1am = document.createElement("button");
	copyPopulateButton1am.innerHTML = "Populate: 1am"
	copyPopulateButton1am.addEventListener('click',function(event){ 
		copyRows({"source":"1:00a","targets":["8:00a","4:00p", "9:00p"]})
	});
	copyPopulateButton1am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["1:00a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   })

		styleRows({targetIDs : ["8:00a","4:00p", "9:00p"], 
			       attribute : "background",
			       value : "green"
			   })

		styleRows({targetIDs : ["8:00a","4:00p", "9:00p"], 
			       attribute : "outline",
			       value : "2px solid green"
			   })

			    //targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"],

	})
	copyPopulateButton1am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["1:00a"], 
			       attribute : "outline",
			       value : ""
			   })
		styleRows({targetIDs : ["8:00a","4:00p", "9:00p"], 
			       attribute : "background",
			       value : ""
			   })

		styleRows({targetIDs : ["8:00a","4:00p", "9:00p"], 
			       attribute : "outline",
			       value : ""
			   })

	})

	var copyPopulateButton130am = document.createElement("button");
	copyPopulateButton130am.innerHTML = "Populate: 1:30am";
	copyPopulateButton130am.addEventListener('click',function(event){ 
		copyRows({"source":"1:30a","targets":["8:30a","11:30a","4:30p"]})
	});
	copyPopulateButton130am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["1:30a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   })

		styleRows({targetIDs : ["8:30a","11:30a","4:30p"], 
			       attribute : "background",
			       value : "green"
			   })

		styleRows({targetIDs : ["8:30a","11:30a","4:30p"], 
			       attribute : "outline",
			       value : "2px solid green"
			   })

	});
	copyPopulateButton130am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["1:30a"], 
			       attribute : "outline",
			       value : ""
			   });
		styleRows({targetIDs : ["8:30a","11:30a","4:30p"], 
			       attribute : "background",
			       value : ""
			   });

		styleRows({targetIDs : ["8:30a","11:30a","4:30p"], 
			       attribute : "outline",
			       value : ""
			   });

	});
	
	var copyPopulateButton2am = document.createElement("button");
	copyPopulateButton2am.innerHTML = "Populate: 2am"
	copyPopulateButton2am.addEventListener('click',function(event){ 
		copyRows({"source":"2:00a","targets":["5:00a","5:00p"]})
	});
	copyPopulateButton2am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["2:00a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   });

		styleRows({targetIDs : ["5:00a","5:00p"], 
			       attribute : "background",
			       value : "green"
			   });

		styleRows({targetIDs : ["5:00a","5:00p"], 
			       attribute : "outline",
			       value : "2px solid green"
			   });

			    //targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"],

	});
	copyPopulateButton2am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["2:00a"], 
			       attribute : "outline",
			       value : ""
			   });
		styleRows({targetIDs : ["5:00a","5:00p"], 
			       attribute : "background",
			       value : ""
			   });

		styleRows({targetIDs : ["5:00a","5:00p"], 
			       attribute : "outline",
			       value : ""
			   });

	});

	var copyPopulateButton230am = document.createElement("button");
	copyPopulateButton230am.innerHTML = "Populate: 2:30am"
	copyPopulateButton230am.addEventListener('click',function(event){ 
		copyRows({"source":"2:30a","targets":["5:30a","5:30p"]})
	});
	copyPopulateButton230am.addEventListener('mouseover',function(event){

		styleRows({targetIDs : ["2:30a"], 
			       attribute : "outline",
			       value : "5px solid red"
			   })

		styleRows({targetIDs : ["5:30a","5:30p"], 
			       attribute : "background",
			       value : "green"
			   })

		styleRows({targetIDs : ["5:30a","5:30p"], 
			       attribute : "outline",
			       value : "2px solid green"
			   })

			    //targetIDs : ["6:00a","9:00a","12:00p", "2:00p", "7:00p", "3:00a"],

	})
	copyPopulateButton230am.addEventListener('mouseout',function(event){
		styleRows({targetIDs : ["2:30a"], 
			       attribute : "outline",
			       value : ""
			   })
		styleRows({targetIDs : ["5:30a","5:30p"], 
			       attribute : "background",
			       value : ""
			   })

		styleRows({targetIDs : ["5:30a","5:30p"], 
			       attribute : "outline",
			       value : ""
			   })

	})
	

	document.body.appendChild(copyPopulateButton11am);
	document.body.appendChild(copyPopulateButton1130am);
	document.body.appendChild(copyPopulateButton12am);
	document.body.appendChild(copyPopulateButton1230am);
	document.body.appendChild(copyPopulateButton1am);
	document.body.appendChild(copyPopulateButton130am);
	document.body.appendChild(copyPopulateButton2am);
	document.body.appendChild(copyPopulateButton230am);
	

	styleRows({targetIDs : ["4:00a","4:30p",], 
		       attribute : "outline",
		       value : "2px solid black"
		   })


/*
2:00am -> 5am 5pm
2:30am -> 530am 530pm 
11am -> 6am -> 9am -> 12pm -> 2pm -> 7pm -> 3am
11:30  -> 630 -> 930 1230p -> 230 730 330a
12am -> 7am, 10am 1pm, 3pm 6pm, 8pm, 10p
1230 -> 730a 1030a 130p 330p 630, 830p 1030
1:00am -> 8am 4pm 9pm 
1:30am -> 830am 1130 430 
*/

}//*** END Build Page

function styleRows(inputOBJ){
	targetIDs = inputOBJ.targetIDs;

	for (var x in targetIDs){

		targetElem = getElem(targetIDs[x])

		targetElem.style[inputOBJ.attribute] = inputOBJ.value

	}//*** END each elem

}

function update_mainTable_row(inputElem,inputValues){


    //var thisRow = getElem("mainTable").children[inputIndex].children;
	var thisRow = getElem(inputElem).children;
	//for (x=0; x<thisRow.children.length; x++){
	//	cl(thisRow.children[x+1])
	//}



	//cl("Row: " + inputIndex);
    //*** input values are in order
    for (x=0; x < (inputValues.length );x++ ) {
    	//*** TD element is thisRow + 1
    	var thisTD = thisRow[ (x + 1) ];
    	//cl(x + ":" + " ThisTD: " + thisTD);
    	
    	
    	//*** Series is thisTD children [0]
    	//cl(inputValues[x]);
    	//cl(thisTD.children[0].value + ":" + thisTD.children[1].value);
    	//cl(inputValues[x].series + ":" + inputValues[x].episode );

    	//**** Assign Series
    	thisTD.children[0].value = inputValues[x].series;
		thisTD.children[0].className = inputValues[x].series;


		//***Draw Episode List based on series
		var newSeriesKey = inputValues[x].series;
			

		var episodeNode = thisTD.children[1]
		//*** Delete existing episodes
		while (episodeNode.children.length > 0) {
			episodeNode.removeChild(episodeNode.children[0])
		}
		//cl("Deleted: " + (x + 1) + ":" + inputIndex)

		//thisEpisode = document.createElement('select');
		//thisEpisode.className = newSeriesKey
		
		//*** Add New Episodes
		var thisSeries = m.series[newSeriesKey]
		//cl(thisSeries)
			
		for (xx in thisSeries){
			var opt1 = document.createElement('option');
			opt1.text = thisSeries[xx];
			opt1.value = thisSeries[xx];
			episodeNode.add(opt1);
			//cl("adding: " + x + ":" + thisSeries[xx])
		}
		episodeNode.className = newSeriesKey;
		


		

    	episodeNode.value = inputValues[x].episode;
		episodeNode.text = inputValues[x].episode;


    	//*** Episodes is thisTD children [1]

    }


}//*** END update_mainTable_row

function import_layout(){

			cl("BEGIN import_layout ")
			var input = document.createElement('input');
			input.type = 'file';

			input.onchange = e => { 
			   // getting a hold of the file reference
			   var file = e.target.files[0]; 

			   // setting up the reader
			   var reader = new FileReader();
			   reader.readAsText(file,'UTF-8');

			   // here we tell the reader what to do when it's done reading...
			   reader.onload = readerEvent => {
			      var importOBJ = readerEvent.target.result; // this is the content!
			      
			      try
			      {
			      	importOBJ = JSON.parse(importOBJ);
	      	
			      }//*** END import Parse Try
			      catch(e)
			      {
			      	alert("Unable to parse file: " + file.name + "\nPlease select a valid Hotkey JSON File");
			      	return;
			      }//**** END Main Import 

			      //*** Loop through content by row
			      //*** ImportOBJ is a list

			      //*** Loop through mainTable
			      var mainTable = getElem("mainTable")
					for (rowCount=0; rowCount < mainTable.children.length; rowCount++){
						cl(mainTable.children[rowCount].className + ":" + mainTable.children[rowCount].id)

						if (mainTable.children[rowCount].className == "mainRow"){
							//*** Update the row with the corresponding imputOBJ value.
							//*** The rowOffset is -8
							getElem("topline").innerHTML = "Loading...Row - " + (rowCount-8)
							update_mainTable_row(mainTable.children[rowCount].id,importOBJ[rowCount-8])
						}
					}//*** END Each element in mainTable

					getElem("topline").innerHTML ="Hey There, episodes loaded"
			      
			      

			   }//*** Handle reader Event
			}//*** Handle Input OnChange

			input.click();

}//*** END import_layout

function init(){

getElem('import_layout').style.display = 'none'
getElem('export_layout').style.display = 'none'

}//*** END init

function convert_table_to_OBJ(){
	var mainTable = getElem("mainTable")

	var mainTable_export = []

	for (rowCount=0; rowCount < mainTable.children.length; rowCount++){
		cl(mainTable.children[rowCount].className + ":" + mainTable.children[rowCount].id)

		if (mainTable.children[rowCount].className == "mainRow"){

			thisRawRow = mainTable.children[rowCount]

			cl(thisRawRow)

			var thisExportRow = [];

			for (tdCount=1; tdCount < 8 ; tdCount++){
				
				var thisTD = thisRawRow.children[tdCount];

				//var thisSeries = thisTD.children[0]
				//var thisEpisode = thisTD.children[1]

				
				var thisTD_OBJ = {
					series : thisTD.children[0].value,
					episode : thisTD.children[1].value
				}

				//*** Add TD OBJ to the export Row
				thisExportRow.push(thisTD_OBJ)

			}//*** END Each TD

			//*** Add the Row to the main table
			mainTable_export.push(thisExportRow);

		}//*** END in mainRow

	}//*** END each child Node


	return JSON.stringify(mainTable_export);




}//*** END Conver table to OBJ

function export_layout(){

	//*** Get table
	var thisOBJ = convert_table_to_OBJ()

	//*********************************************************************************	
	//*** Build a FileName based on Date and Time, because we can't do overwrites
	//*********************************************************************************
	var d = new Date();

	var thisYear = d.getUTCFullYear();

	thisYear = thisYear.toString().substring(2);

	var thisMonth = d.getUTCMonth();

	var thisDay = d.getDay();

	var thisHour = d.getHours();

	var thisMinute = d.getMinutes();

	var thisSecond = d.getSeconds();

	var fixTimes = [ thisMonth, thisDay, thisHour, thisMinute, thisSecond]

	for (var x in fixTimes){
		if (fixTimes[x] < 10){
			fixTimes[x] = "0" + fixTimes[x].toString();
		}
	}

	var fileTime = thisYear + "_" + fixTimes[0] + "_" + fixTimes[1] +"-" + fixTimes[2] + "_" + fixTimes[3] + "_" + fixTimes[4] + "__";

	//*** Save to a file
	var element = document.createElement('a');
	element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(thisOBJ));
	element.setAttribute('download', fileTime + "schedule.json");

	element.style.display = 'none';
	document.body.appendChild(element);

	element.click();

	document.body.removeChild(element);



}//*** END export_layout




</script>
<body onload='init()'>
<h1 id="topline">Hey there!</h1>
<p>Let's schedule some localish</p>
<button id ='readText' onclick='readText()'>Load JSON Data File</button>
<button id='import_layout' onclick='import_layout()'>Import Layout</button>
<button id='export_layout' onclick='export_layout()'>Export Layout</button>
</body>
</html>